(*
 * $ cd <JiecLib Project Root>
 * $ jiecc ./test/stats/descriptive/test_mode.txt -I. -I./vendor/jiecunit/sys -I./vendor/jiecunit -D_TEST_ -o ./test/stats/descriptive/test_mode.xml -t omron
 *)
{#include <jiecunit.txt>}
{#include <stats/descriptive/mode.txt>}

{#ifdef _TEST_}
DEFINE_CONFIGURATION(
	_JIEC_TESTNAMES_LIST_(
		'test_stats_mode'
	)
)
{#endif}

{#define EPS 1.0e-9}

TEST_S(test_stats_mode)
	var
		x_1: array[0..6] of lreal := [1.0, 2.0, 2.0, 3.0, 3.0, 3.0, 4.0];
		x_2: array[0..4] of lreal := [5.0, 5.0, 5.0, 5.0, 5.0];
		x_3: array[0..5] of lreal := [1.0, 2.0, 3.0, 4.0, 5.0, 6.0];
		x_4: array[0..7] of lreal := [10.0, 20.0, 20.0, 30.0, 30.0, 30.0, 40.0, 50.0];
		x_5: array[0..0] of lreal := [42.0];
		x_6: array[0..6] of lreal := [1.0, 1.0, 2.0, 2.0, 3.0, 4.0, 5.0];
		x_a1: array[0..7] of lreal := [100.0, 100.0, 100.0, 200.0, 300.0, 400.0, 500.0, 600.0];
		x_a2: array[0..5] of lreal := [5.0, 5.0, 10.0, 10.0, 15.0, 20.0];
		x_a3: array[0..8] of lreal := [7.0, 8.0, 9.0, 7.0, 8.0, 7.0, 10.0, 11.0, 12.0];
		x_a4: array[0..6] of lreal := [1.5, 2.5, 3.5, 2.5, 4.5, 2.5, 5.5];
		work_1: array[0..6] of lreal;
		work_2: array[0..4] of lreal;
		work_3: array[0..5] of lreal;
		work_4: array[0..7] of lreal;
		work_5: array[0..0] of lreal;
		work_6: array[0..6] of lreal;
		work_a1: array[0..7] of lreal;
		work_a2: array[0..5] of lreal;
		work_a3: array[0..8] of lreal;
		work_a4: array[0..6] of lreal;
		result: lreal;
	end
	{st}
	// distinct modes
	EXPECT_NEAR(3.0, Stats_mode(data:=x_1, work:=work_1), EPS);
	EXPECT_NEAR(5.0, Stats_mode(data:=x_2, work:=work_2), EPS);
	EXPECT_NEAR(1.0, Stats_mode(data:=x_3, work:=work_3), EPS);
	EXPECT_NEAR(30.0, Stats_mode(data:=x_4, work:=work_4), EPS);
	EXPECT_NEAR(42.0, Stats_mode(data:=x_5, work:=work_5), EPS);
	EXPECT_NEAR(1.0, Stats_mode(data:=x_6, work:=work_6), EPS);

	// large count on single mode
	result := Stats_mode(data:=x_a1, work:=work_a1);
	EXPECT_NEAR(100.0, result, EPS);

	// tie handling
	result := Stats_mode(data:=x_a2, work:=work_a2);
	EXPECT_TRUE(result = 5.0 or result = 10.0);

	// repeated non-integer
	result := Stats_mode(data:=x_a3, work:=work_a3);
	EXPECT_NEAR(7.0, result, EPS);

	result := Stats_mode(data:=x_a4, work:=work_a4);
	EXPECT_NEAR(2.5, result, EPS);
	{end}
END_TEST_S

{#undef EPS}
