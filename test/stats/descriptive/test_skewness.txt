(*
 * $ cd <JiecLib Project Root>
 * $ jiecc ./test/stats/descriptive/test_skewness.txt -I./src -I./vendor/jiecunit/sys -I./vendor/jiecunit -D_TEST_ -o ./test/stats/descriptive/test_skewness.xml -t omron
 *)
{#include <jiecunit.txt>}
{#include <stats/descriptive/skewness.txt>}

{#ifdef _TEST_}
DEFINE_CONFIGURATION(
	_JIEC_TESTNAMES_LIST_(
		'test_stats_skewness'
	)
)
{#endif}

{#define EPS 1.0e-9}

TEST_S(test_stats_skewness)
	var
		x_seq5: array[0..4] of lreal := [1.0, 2.0, 3.0, 4.0, 5.0];
		x_mixed1: array[0..6] of lreal := [1.0, 1.0, 2.0, 2.0, 3.0, 5.0, 10.0];
		x_mixed2: array[0..6] of lreal := [1.0, 6.0, 8.0, 8.0, 9.0, 9.0, 10.0];
		x_seq10: array[0..9] of lreal := [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0];
		x_neg: array[0..4] of lreal := [-5.0, -3.0, -1.0, -7.0, -2.0];
		x_decimals: array[0..9] of lreal := [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0];
		x_large: array[0..4] of lreal := [100.0, 200.0, 300.0, 400.0, 500.0];
		x_two: array[0..1] of lreal := [10.0, 20.0];
		x_repeated1: array[0..6] of lreal := [1.0, 1.0, 1.0, 5.0, 9.0, 9.0, 9.0];
		x_repeated2: array[0..8] of lreal := [1.0, 2.0, 2.0, 2.0, 5.0, 8.0, 8.0, 8.0, 9.0];
		x_right_skew: array[0..5] of lreal := [1.0, 2.0, 2.0, 3.0, 4.0, 10.0];
		x_left_skew: array[0..4] of lreal := [1.0, 7.0, 8.0, 9.0, 10.0];
	end
	{st}
		// Test with bias=true - biased skewness estimator
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_seq5, bias:=true), EPS);
		EXPECT_NEAR(1.381230331499, Stats_skewness(data:=x_mixed1, bias:=true), EPS);
		EXPECT_NEAR(-1.408400273389, Stats_skewness(data:=x_mixed2, bias:=true), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_seq10, bias:=true), EPS);
		EXPECT_NEAR(-0.403407113971, Stats_skewness(data:=x_neg, bias:=true), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_decimals, bias:=true), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_large, bias:=true), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_two, bias:=true), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_repeated1, bias:=true), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_repeated2, bias:=true), EPS);
		EXPECT_NEAR(1.418505623226, Stats_skewness(data:=x_right_skew, bias:=true), EPS);
		EXPECT_NEAR(-1.138419957661, Stats_skewness(data:=x_left_skew, bias:=true), EPS);

		// Test with bias=false - unbiased skewness estimator
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_seq5, bias:=false), EPS);
		EXPECT_NEAR(1.790279124644, Stats_skewness(data:=x_mixed1, bias:=false), EPS);
		EXPECT_NEAR(-1.825495394280, Stats_skewness(data:=x_mixed2, bias:=false), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_seq10, bias:=false), EPS);
		EXPECT_NEAR(-0.601363819631, Stats_skewness(data:=x_neg, bias:=false), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_decimals, bias:=false), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_large, bias:=false), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_two, bias:=false), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_repeated1, bias:=false), EPS);
		EXPECT_NEAR(0.000000000000, Stats_skewness(data:=x_repeated2, bias:=false), EPS);
		EXPECT_NEAR(1.942368819473, Stats_skewness(data:=x_right_skew, bias:=false), EPS);
		EXPECT_NEAR(-1.697056274848, Stats_skewness(data:=x_left_skew, bias:=false), EPS);

		// Comparison tests - sign verification
		EXPECT_GT_LREAL(Stats_skewness(data:=x_right_skew, bias:=true), 0.0);
		EXPECT_LT_LREAL(Stats_skewness(data:=x_left_skew, bias:=true), 0.0);
		EXPECT_GT_LREAL(Stats_skewness(data:=x_mixed1, bias:=true), 0.0);
		EXPECT_LT_LREAL(Stats_skewness(data:=x_mixed2, bias:=true), 0.0);
	{end}
END_TEST_S

{#undef EPS}
