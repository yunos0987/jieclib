(*
 * $ cd <JiecLib Project Root>
 * $ jiecc ./test/stats/descriptive/test_arithmetic_mean.txt -I./src -I./vendor/jiecunit/sys -I./vendor/jiecunit -D_TEST_ -o ./test/stats/descriptive/test_arithmetic_mean.xml -t omron
 *)
{#include <jiecunit.txt>}
{#include <stats/descriptive/arithmetic_mean.txt>}

{#ifdef _TEST_}
DEFINE_CONFIGURATION(
	_JIEC_TESTNAMES_LIST_(
		'test_stats_arithmetic_mean',
		'test_stats_weighted_arithmetic_mean',
		'test_stats_moving_average'
	)
)
{#endif}

{#define EPS 1.0e-9}

TEST_S(test_stats_arithmetic_mean)
	var
		x_basic: array[0..4] of lreal := [1.0, 2.0, 3.0, 4.0, 5.0];
		x_negative: array[0..4] of lreal := [-2.0, -1.0, 0.0, 1.0, 2.0];
		x_zeros: array[0..3] of lreal := [0.0, 0.0, 0.0, 0.0];
		x_single: array[0..0] of lreal := [42.0];
		x_precision: array[0..2] of lreal := [0.1, 0.2, 0.3];
		x_large: array[0..3] of lreal := [1000.0, 2000.0, 3000.0, 4000.0];
		//
		result: lreal;
		result_eno: bool;
	end
	{st}
		result := Stats_arithmetic_mean(data:=x_basic);
		EXPECT_NEAR(3.0, result, EPS);

		result := Stats_arithmetic_mean(data:=x_negative);
		EXPECT_NEAR(0.0, result, EPS);

		result := Stats_arithmetic_mean(data:=x_zeros);
		EXPECT_NEAR(0.0, result, EPS);

		result := Stats_arithmetic_mean(data:=x_single);
		EXPECT_NEAR(42.0, result, EPS);

		result := Stats_arithmetic_mean(data:=x_precision);
		EXPECT_NEAR(0.2, result, EPS);

		result := Stats_arithmetic_mean(data:=x_large);
		EXPECT_NEAR(2500.0, result, EPS);
	{end}
END_TEST_S

TEST_S(test_stats_weighted_arithmetic_mean)
	var
		data1: array[0..3] of lreal := [1.0, 2.0, 3.0, 4.0];
		weights1: array[0..3] of lreal := [1.0, 2.0, 3.0, 4.0];
		data2: array[0..4] of lreal := [1.0, 2.0, 3.0, 4.0, 5.0];
		weights2: array[0..4] of lreal := [1.0, 1.0, 1.0, 1.0, 1.0];
		data3: array[0..3] of lreal := [50.0, 60.0, 70.0, 80.0];
		weights3: array[0..3] of lreal := [0.4, 0.3, 0.2, 0.1];
		data4: array[0..2] of lreal := [10.0, 20.0, 30.0];
		weights4: array[0..2] of lreal := [2.0, 3.0, 5.0];
		result, regular_mean: lreal;
	end
	{st}
		result := Stats_weighted_arithmetic_mean(data:=data1, weights:=weights1);
		EXPECT_NEAR(3.0, result, EPS);

		result := Stats_weighted_arithmetic_mean(data:=data2, weights:=weights2);
		regular_mean := Stats_arithmetic_mean(data:=data2);
		EXPECT_NEAR(regular_mean, result, EPS);

		result := Stats_weighted_arithmetic_mean(data:=data3, weights:=weights3);
		EXPECT_NEAR(60.0, result, EPS);

		result := Stats_weighted_arithmetic_mean(data:=data4, weights:=weights4);
		EXPECT_NEAR(23.0, result, EPS);
	{end}
END_TEST_S

TEST_S(test_stats_moving_average)
	var
		data1: array[0..4] of lreal := [1.0, 2.0, 3.0, 4.0, 5.0];
		result1: array[0..2] of lreal;
		data2: array[0..6] of lreal := [10.0, 20.0, 30.0, 40.0, 50.0, 60.0, 70.0];
		data3: array[0..5] of lreal := [2.0, 4.0, 6.0, 8.0, 10.0, 12.0];
		result2: array[0..4] of lreal;
		result3: array[0..3] of lreal;
		data4: array[0..5] of lreal := [1.0, 2.0, 3.0, 4.0, 5.0, 6.0];
		result4: array[0..2] of lreal;
	end
	{st}
		Stats_moving_average(data:=data1, window:=3, result:=result1);
		EXPECT_NEAR(2.0, result1[0], EPS);
		EXPECT_NEAR(3.0, result1[1], EPS);
		EXPECT_NEAR(4.0, result1[2], EPS);

		Stats_moving_average(data:=data2, window:=3, result:=result2);
		EXPECT_NEAR(20.0, result2[0], EPS);
		EXPECT_NEAR(30.0, result2[1], EPS);
		EXPECT_NEAR(40.0, result2[2], EPS);
		EXPECT_NEAR(50.0, result2[3], EPS);
		EXPECT_NEAR(60.0, result2[4], EPS);

		Stats_moving_average(data:=data3, window:=3, result:=result3);
		EXPECT_NEAR(4.0, result3[0], EPS);
		EXPECT_NEAR(6.0, result3[1], EPS);
		EXPECT_NEAR(8.0, result3[2], EPS);
		EXPECT_NEAR(10.0, result3[3], EPS);

		Stats_moving_average(data:=data4, n:=4, window:=2, result:=result4);
		EXPECT_NEAR(1.5, result4[0], EPS);
		EXPECT_NEAR(2.5, result4[1], EPS);
		EXPECT_NEAR(3.5, result4[2], EPS);
	{end}
END_TEST_S

{#undef EPS}