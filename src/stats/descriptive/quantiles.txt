(*
 * $ cd <JiecLib Project Root>
 * $ jiecc ./src/stats/descriptive/quantiles.txt -I./src -I./vendor/jiecunit/sys -o ./src/stats/descriptive/quantiles.xml -t omron
 *)
{#ifndef __STATS_DESCRIPTIVE_QUANTILES_TXT__}
{#define __STATS_DESCRIPTIVE_QUANTILES_TXT__}

{#include <sys.txt>}
{#include <stats/sequences/quantile.txt>}

(*{doc パーセンタイル値を計算（デフォルト: quantile_type=7）
@inout data サンプルデータを含む配列。
  正規配列（次元の始点が0で要素数1以上）でなければいけない。
@input n 先頭n個を使用する。
  デフォルト値: -1
@input p 入力値。
@inout work 作業配列。
  正規配列（次元の始点が0で要素数1以上）でなければいけない。
@return 計算結果。
@error 入力値が不正な場合。}*)
function Stats_percentile: lreal
	_PROLOGUE_OF_FUNCTION_()
	var_in_out
		(*{doc サンプルデータを含む配列。}*)
		data: array[*] of lreal;
	end
	var_input
		(*{doc 先頭n個を使用する。}*)
		n: dint := -1;
		(*{doc 分位点(0..1)。}*)
		p: lreal;
	end
	var_in_out
		(*{doc 作業配列。}*)
		work: array[*] of lreal;
	end
	{st}
	Stats_percentile := Stats_quantile(
		data := data,
		n := n,
		p := p,
		quantile_type := 7,
		work := work,
		eno=>eno
	);
	{end}
end

(*{doc 四分位点（Q1,Q2,Q3）
@inout data サンプルデータを含む配列。
  正規配列（次元の始点が0で要素数1以上）でなければいけない。
@input n 先頭n個を使用する。
  デフォルト値: -1
@inout result 結果を格納する配列。
  正規配列（次元の始点が0で要素数1以上）でなければいけない。
@inout work 作業配列。
  正規配列（次元の始点が0で要素数1以上）でなければいけない。
@error 入力値が不正な場合。}*)
function Stats_quartiles_desc
	_PROLOGUE_OF_FUNCTION_()
	var_in_out
		(*{doc サンプルデータを含む配列。}*)
		data: array[*] of lreal;
	end
	var_input
		(*{doc 先頭n個を使用する。}*)
		n: dint := -1;
	end
	var_in_out
		(*{doc 結果を格納する配列。}*)
		result: array[*] of lreal;
		(*{doc 作業配列。}*)
		work: array[*] of lreal;
	end
	{st}
	Stats_quantiles(data:=data, n:=n, result:=result, work:=work, eno=>eno);
	{end}
end

(*{doc 四分位範囲 IQR = Q3 - Q1
@inout data サンプルデータを含む配列。
  正規配列（次元の始点が0で要素数1以上）でなければいけない。
@input n 先頭n個を使用する。
  デフォルト値: -1
@inout q_work 作業配列。
  正規配列（次元の始点が0で要素数1以上）でなければいけない。
@inout work 作業配列。
  正規配列（次元の始点が0で要素数1以上）でなければいけない。
@return 計算結果。
@error 入力値が不正な場合。}*)
function Stats_iqr: lreal
	_PROLOGUE_OF_FUNCTION_()
	var_in_out
		(*{doc サンプルデータを含む配列。}*)
		data: array[*] of lreal;
	end
	var_input
		(*{doc 先頭n個を使用する。}*)
		n: dint := -1;
	end
	var_in_out
		(*{doc 四分位点を格納する配列。長さ3以上を想定。}*)
		q_work: array[*] of lreal;
		(*{doc 作業配列。}*)
		work: array[*] of lreal;
	end
	{st}
	Stats_quantiles(data:=data, n:=n, result:=q_work, work:=work, eno=>eno);
	if not eno then
		return;
	end_if;

	Stats_iqr := q_work[2] - q_work[0];
	{end}
end

{#endif}

