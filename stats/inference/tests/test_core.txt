(*
 * $ cd <JiecLib Project Root>
 * $ jiecc ./stats/inference/tests/test_core.txt -I. -I./vendor/jiecunit/sys -o ./stats/inference/tests/test_core.xml -t omron
 *)
{#ifndef __STATS_INFERENCE_TESTS_TEST_CORE_TXT__}
{#define __STATS_INFERENCE_TESTS_TEST_CORE_TXT__}

{#include <sys.txt>}
{#include <stats/distributions/continuous/normal.txt>}
{#include <stats/distributions/continuous/student_t.txt>}
{#include <stats/distributions/continuous/chi_square.txt>}

(*{doc 検定結果型}*)
type Stats_TestResult :
	struct
		statistic: lreal;
		pvalue: lreal;
		df: lreal;
		ci_lower: lreal;
		ci_upper: lreal;
		effect_size: lreal;
	end_struct;
end_type

(*{doc 正規分布の p-value 計算（両側）
@input z 入力値。
@return 計算結果。
@error 入力値が不正な場合。}*)
function Stats_p_value_normal_two_tailed: lreal
	_PROLOGUE_OF_FUNCTION_()
	var_input
		(*{doc 入力値。}*)
		z: lreal;
	end
	var_temp cdf_val: lreal; end
	{st}
	cdf_val := Stats_normal_cdf(x:=abs(z), mu:=0.0, sigma:=1.0, eno=>eno);
	Stats_p_value_normal_two_tailed := 2.0 * (1.0 - cdf_val);
	{end}
end

(*{doc t 分布の p-value 計算（両側）
@input t 入力値。
@input df 自由度。
@return 計算結果。
@error 入力値が不正な場合。}*)
function Stats_p_value_t_two_tailed: lreal
	_PROLOGUE_OF_FUNCTION_()
	var_input
		(*{doc t統計量。}*)
		t: lreal;
		(*{doc 自由度。}*)
		df: lreal;
	end
	var_temp cdf_val: lreal; end
	{st}
	if df <= 0.0 then
		eno := false;
		return;
	end_if;
	cdf_val := Stats_student_t_cdf(t:=abs(t), df:=df, eno=>eno);
	Stats_p_value_t_two_tailed := 2.0 * (1.0 - cdf_val);
	{end}
end

(*{doc カイ二乗分布の p-value 計算（右側）
@input chi_sq 入力値。
@input df 自由度。
@return 計算結果。
@error 入力値が不正な場合。}*)
function Stats_p_value_chi_square_right: lreal
	_PROLOGUE_OF_FUNCTION_()
	var_input
		(*{doc カイ二乗統計量。}*)
		chi_sq: lreal;
		(*{doc 自由度。}*)
		df: lreal;
	end
	var_temp cdf_val: lreal; end
	{st}
	if (df <= 0.0) or (chi_sq < 0.0) then
		eno := false;
		return;
	end_if;
	cdf_val := Stats_chi_square_cdf(x:=chi_sq, df:=df, eno=>eno);
	Stats_p_value_chi_square_right := 1.0 - cdf_val;
	{end}
end

{#endif}

