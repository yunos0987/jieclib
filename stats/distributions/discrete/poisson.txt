(*
 * $ cd <JiecLib Project Root>
 * $ jiecc ./stats/distributions/discrete/poisson.txt -I. -I./vendor/jiecunit/sys -o ./stats/distributions/discrete/poisson.xml -t omron
 *)
{#ifndef __STATS_DISTRIBUTIONS_DISCRETE_POISSON_TXT__}
{#define __STATS_DISTRIBUTIONS_DISCRETE_POISSON_TXT__}

{#include <sys.txt>}
{#include <stats/distributions/core/special_functions.txt>}

(*{doc ポアソン分布の確率質量関数
P(X = k) = (lambda^k * exp(-lambda)) / k!
@input k 事象数。
@input lambda レート。
@return 計算結果。
@error 入力値が不正な場合。}*)
function Stats_poisson_pmf: lreal
	_PROLOGUE_OF_FUNCTION_()
	var_input
		(*{doc 事象数。}*)
		k: dint;
		(*{doc レート。}*)
		lambda: lreal;
	end
	var_temp k_factorial: lreal; end
	{st}
		if k < 0 or lambda < 0.0 then
			eno := false;
			Stats_poisson_pmf := 0.0;
			return;
		end_if;

		if lambda = 0.0 then
			if k = 0 then
				Stats_poisson_pmf := 1.0;
			else
				Stats_poisson_pmf := 0.0;
			end_if;
			return;
		end_if;

		k_factorial := Stats_gamma(x:=dint_to_lreal(k + 1));
		if k_factorial <= 0.0 then
			eno := false;
			Stats_poisson_pmf := 0.0;
			return;
		end_if;

		Stats_poisson_pmf := (lambda ** dint_to_lreal(k)) * exp(-lambda) / k_factorial;
	{end}
end

(*{doc ポアソン分布の累積分布関数
P(X <= k) = sum (i=0..k) pmf(i)
@input k 事象数。
@input lambda レート。
@return 計算結果。
@error 入力値が不正な場合。}*)
function Stats_poisson_cdf: lreal
	_PROLOGUE_OF_FUNCTION_()
	var_input
		(*{doc 事象数。}*)
		k: dint;
		(*{doc レート。}*)
		lambda: lreal;
	end
	var_temp
		i: dint;
		sum_val, term: lreal;
	end
	{st}
		if k < 0 or lambda < 0.0 then
			eno := false;
			Stats_poisson_cdf := 0.0;
			return;
		end_if;

		sum_val := 0.0;
		term := exp(-lambda);
		sum_val := term;

		for i := 1 to k do
			term := term * lambda / dint_to_lreal(i);
			sum_val := sum_val + term;
		end_for;

		Stats_poisson_cdf := sum_val;
	{end}
end

(*{doc ポアソン分布の平均 = lambda
@input lambda レート。
@return 計算結果。
@error 入力値が不正な場合。}*)
function Stats_poisson_mean: lreal
	_PROLOGUE_OF_FUNCTION_()
	var_input
		(*{doc レート。}*)
		lambda: lreal;
	end
	{st} Stats_poisson_mean := lambda; {end}
end

(*{doc ポアソン分布の分散 = lambda
@input lambda レート。
@return 計算結果。
@error 入力値が不正な場合。}*)
function Stats_poisson_variance: lreal
	_PROLOGUE_OF_FUNCTION_()
	var_input
		(*{doc レート。}*)
		lambda: lreal;
	end
	{st} Stats_poisson_variance := lambda; {end}
end

{#endif}

